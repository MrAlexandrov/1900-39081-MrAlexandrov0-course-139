# Сервис bookmarker

В данном задании вам предлагается проверить работоспособность бэкенда для веб-сервиса сохранения закладок.
Необходимо написать unit- и интеграционные тесты на данный код, а также исправить баги, найденные в процессе тестирования.

## Задание

Изучите код приложения и напишите _**модульные**_ и _**интеграционные**_ (API) тесты на все опубликованные эндпоинты.

Необходимо добиться покрытия кода тестами минимум на 70%, правда в CI данный порог никаким образом не проверяется.
Вас не ограничивают в выборе дополнительных инструментов для тестирования: вы можете использовать как инструменты из лекции, так и брать неупомянутые в ней библиотеки.

При написании кода тестов, старайтесь чтобы он был лаконичен. Пишите вспомогательные классы для этого, если потребуется.

Обязательные требования:
1. Добавьте в папку `tests` в корне проекта необходимые интеграционные тесты с использованием библиотеки [pytest](https://docs.pytest.org/en/7.1.x/):
    - папка и базовая конфигурация уже добавлены за вас;
    - напишите интеграционные тесты на все HTTP API, имеющиеся в проекте;
2. Добавьте в папку `unittests` в корне проекта необходимые модульные тесты:
    - напишите модульные тесты, как минимум на функцию `BuildDbRequest` (вы можете реогранизовывать код проекта при необходимости);
3. При обнаружении ошибок, зафиксируйте их в отчете о тестировании (заведите issue в своем репозитории, укажите критичность - см. [bug-severity](https://www.software-testing.by/blog/bug-severity/).
4. Исправьте обнаруженные ошибки и добейтесь прохождения всех своих тестов

### Краткое описание функциональности:

1. Регистрация пользователя (по логину и паролю)
2. Аутентификация пользователя по логину и паролю с выдачей авторизационного токена
3. Создание закладки с указанием URL и названия страницы
    - при сохранении закладки есть возможность назначить тэг

4. Просмотр закладок
    - просмотр всех закладок
    - просмотр одной конкретной закладки
    - просмотр всех закладок под определенным тэгом
    - задание порядка отображения закладок по:
        - заголовку страницы
        - URL страницы
        - дате добавления
    - ограничение на количество закладок в ответе
5. Удаление закладки


## Запуск приложения
1. Запустите сервис командой `make docker-start-service-debug`
2. Зарегистрируйте нового пользователя через запрос в ручку `/register`
```
curl -XPOST "http://localhost:8080/register" -F "email=me@ya.ru" -F "password=pswd"
```
2. Авторизуйтесь под своим новым пользователем
```
curl -XPOST "http://localhost:8080/login" -F "email=me@ya.ru" -F "password=pswd"
```
В ответ придет JSON, содержащий идентификатор сессии, следующего вида: `{"id":"f39227e0-494e-460e-982b-80b081f8fa4e"}`. С помощью этого идентификатора будет происходить авторизация во всех остальных ручках. Его необходимо передавать в хедере с ключом `X-Ya-User-Ticket` 
3. Сохраните свою первую закладку
```
curl -XPOST "http://localhost:8080/v1/bookmarks" \
    -H "X-Ya-User-Ticket: <AUTH_TOKEN>" \
    -H "Content-Type: application/json" \
    -d '{"url": "https://ya.ru", "title": "Yandex"}'
```
4. Остальные ручки и их спецификацию можно посмотреть в [openapi.yaml](openapi.yaml)

## Работа с приложением

### Требования

Необходимо, чтобы были установлены следующие компоненты:

- `Docker` и `docker-compose`
- `Python`

### Установка

1. Склонируйте репозиторий
    ```
    git clone your-service-repo && cd your-service-repo
    ```
2. Обновите сабмодули
   ```
   git submodule update --init
   ```
3. Запустите сборку
   - В docker контейнере (рекомендуется)
     ```
     make docker-build-debug
     ```
   - Локально (не рекомендуется)
     ```
     make build-debug
     ```

### Запуск

- Запуск приложения в docker контейнере (рекомендуется):
```commandline
make docker-start-service-debug
```

- Запуск приложения локально (не рекомендуется):
```commandline
make service-start-debug
```

### Тестирование

- Запуск тестов в docker контейнере (рекомендуется):
```commandline
make docker-test-debug
```

- Запуск тестов локально (не рекомендуется):
```commandline
make test-debug
```

### Запуск форматирования кода
```commandline
make format
```

### Попробнее про фреймворк userver

- Документация
https://userver.tech/index.html

- Исходный код
https://github.com/userver-framework/userver

- Шаблон сервиса
https://github.com/userver-framework/service_template

- Шаблон сервиса с базой
https://github.com/userver-framework/pg_service_template

- Полный список возможных команд сервиса
https://github.com/userver-framework/pg_service_template?tab=readme-ov-file#makefile
